## 常见漏洞

高并发时记得挂代理
推荐测试站，特征：dev,stc,stm,test 

### （二）任意用户漏洞

### 任意用户密码重置

密码找回功能可能是使用的前端校验，可通过谷歌语法检索正确的手机号（可先查找域名所在的地，然后尝试当地手机号开头），在抓包时修改为其它手机号（可尝试将响应包中的 false 改为 true ）

```
site:*.examlpe.edu.cn "sjh"
site:*.examlpe.edu.cn "手机号"
site:*.examlpe.edu.cn "139"
site:*.examlpe.edu.cn inurl:teacher
site:*.examlpe.edu.cn inurl:system
site:*.examlpe.edu.cn inurl:login
site:*.examlpe.edu.cn inurl:admin
site:*.examlpe.edu.cn inurl:user
site:*.examlpe.edu.cn inurl:userid
site:*.examlpe.edu.cn inurl:id
site:*.examlpe.edu.cn inurl:pwd
site:*.examlpe.edu.cn inurl:password
site:*.examlpe.edu.cn fieltypr:pdf
site:*.examlpe.edu.cn fieltypr:doc
site:*.examlpe.edu.cn fieltypr:xls
```

可能存在 sql 注入的语法

```
inurl:"php?id="
```

可能存在 xss 的语法

```
inurl:"keyword="
```

### 案例

1. 四位数验证码可爆破

2. 验证码回显

   ```
   短信验证码存在于响应包参数中
   ```

3. 只验证了验证码，没有做绑定验证

   ```
   攻击者获取自己的短信验证码之后，可将手机号修改为目标手机号
   ```

4. 修改返回包

   ```
   输入任意短信验证码
   响应包状态码修改为 200||0||1||-1
   返回数据修改为 true||success||1||0||-1  
   或者直接替换为正确的响应包
   ```

5. 双写

   ```
   多用户使用同一个短信验证码
   mobile=13712345678,13823456789&code=134567
   或者
   mobile=13712345678&13823456789&code=134567
   ```

6. 随意验证码

   ```
   填写任意验证码即可（位数要与短信验证码相同）
   ```

8. 验证码为空

   ```
   将验证码的值修改为 null，或者修改为空值
   &code=null
   &code=
   也可尝试 000000,111111,1,-1,0
   ```

9. 奇葩绕过

   ```
   任意用用户密码重置：
   输入用户名 -> 向绑定的手机号发送验证码 -> 输入验证码
   可在请求包中将手机号修改为攻击者手机号（这种场景下一般有手机号泄露）
   ```

   ```
   返回包中会出现加密的密码或绑定的邮箱||手机号
   ```

   ```
   找回密码功能 URL 如 http://example.com/u/getpwd1.html
   访问 http://example.com/u/getpwd1.html 输入用户名
   访问 http://example.com/u/getpwd2.html 输入验证码
   此时可访问 http://example.com/u/getpwd3.html 直接任意用户密码重置，绕过验证码
   ```

   ```
   提交密码重置时修改 user_id 或 user_name 可实现任意用户密码重置
   ```

   ```
   通用框架漏洞
   nday finger:
   login,xxxxxxxxx
   logout,xxxxxxxxx
   login,xxxxxxxxx
   logout,xxxxxxxxx
   ```

10. 重置链接

    ```
    邮箱接收到的重置链接如：id=xxxxxxx 可被解码（如 base64,md5）
    获取正确格式后可自己构造，以重置任意用户密码
    ```

11. 万能密码

    ```
    sql 注入
    参考：https://www.cnblogs.com/pass-A/p/11134988.html
    ```

12. 验证码复用

    ```
    验证吗可重复利用，导致可爆破
    ```

13. session 覆盖

    ```
    在一个浏览器打开两个标签页，分别登录账号 A 和账号 B ，都进入密码重置界面
    对账号 A 进行校验完成密码重置之后，发现账号 B 可以不需要进行校验即可直接重置密码
    ```

    ```
    有时修改 ID 进行越权时只是会访问主页，不会进行操作，若返回包出现 session (token，jwt 等 )可利用 session 构造请求包尝试越权
    ```

    

### （三）越权漏洞

可以做不属于自己权限范围的事就叫越权

### 常见越权

1. 直接更改 ID

   ```
   将 id=1 修改为 id=2，可看到其他用户的信息
   ```

2. 使用 findsomething 查找 js 接口，然后拼接

   ```
   无危害的接口可尝试根据返回值构造新的请求包，扩大危害
   假设接口为：/api/menu
   则可根据经验构造增删改查接口：
   POST /api/menu/add || POST/PUT /api/menu
   GET /api/menu/del?id= || POST /api/menu || DELETE /api/menu/id
   POST /api/menu/modify || POST /api/menu/
   GET /api/menu/list || /api/menu/all
   ```

3. 越权+self_xss

   ```
   发现 self_xss 可以尝试越权，如果可以越权修改他人信息，可以利用存储型 xss 获取 cookie
   ```

4. 前端越权

   ```
   简历模板 A 可以免费预览，简历模板 B 要付费预览
   可见 A 的前端预览参数插入到 B 的前端尝试预览
   ```

**bypass**


1. 删除多余字段

   ```
   有的时候 ID 是与 token 绑定的，将 token 删除之后修改 ID 才会有效果
   保留 token 和 ID，删除其他字段，此时修改 ID 可能会有效
   ```

2. 同时修改 cookie

   ```
   将可遍历（有规律，能够爆破或预测的）的 cookie 和 ID 都修改为小号的，即可实现绕过
   ```

3. 绕过原始密码认证

   ```
   假设数据包为：
   user_id=test&old_passwd=123123&new_passwd=121212
   删除原始密码，发送数据包即可重置密码
   user_id=test&new_passwd=121212
   修改账户，再次发送数据包即可实现任意用户密码重置
   user_id=admin&new_passwd=121212
   ```

4. drop 跳转数据包

   ```
   访问某些网站后台时，可能会跳转到用户登录页面
   可直接拦截请求包，drop 跳转请求包
   实现免登录进入后台
   也可直接分析进入后台时的数据包有无敏感信息
   ```

5. 需要多个数据

   ```
   将删除收件地址时的数据包中的 ID 修改为小号的 ID 可能可以删除小号的收货地址
   但是某些情况下必须保留一条收获地址，因此只有当创建多个收货地址的时候才能实现越权删除
   ```

6. 双因子

   ```
   某些网站存在双因子绑定，如：
   user_id:123123&uuid:eca5c6as6d
   其中 uuid 无法遍历
   此时可通过查看其他用户发表的文章，评论，或者个人空间是否泄露，以获取 uuid 和 user_id（这种情况可能存在于同一家公司的两个不同的网站中）
   ```

7. 修改 URL 路径

   ```
   假设 url 为 http://example.com/admin/index.php?app=user&page=4
   那么直接将用户修改为管理员即可访问管理员账户
   http://example.com/admin/index.php?app=admin
   类似参数可使用字典对 username 爆破
   ```

8. 修改收获地址 ID

   ```
   提交订单时会出现收货地址 ID：memberAddressld=1042921
   修改 ID 即可将收获地址改为其他人的
   ```

9. 查看收获地址

   ```
   查看收获地址时将请求包中的手机号或 ID 改为 其他用户，可能可以越权
   将手机号改为 11111111111 可查看全站地址
   也可尝试 1,-1,0,null 或删除值，删除字段
   ```

10. 使用 findsomething 审计 js 文件，查找接口

    ```
    接口示例：
    path:"/taskDetail/:id"
    可尝试遍历接口（对 id 爆破）：
    http://example.com/taskDetail/:1
    实际上可能为
    http://example.com/taskDetail/2104089111?type=taskDetail
    ```
    
11. 若存在不安全的前端验证，可通过修改 url 直接访问账号主页，绕过密码验证

### URL 跳转

1. 修改 URL 中的参数值，如： `http://debian.local/pikachu/vul/urlredirect/urlredirect.php?url=i`  ，修改后发生跳转，即存在 URL 跳转

   ```
   http://debian.local/pikachu/vul/urlredirect/urlredirect.php?url=http://example.com
   ```

2. finger

   ```
   finger:（凡是 ?xxx=xxx 都可以尝试 ?xxx=http://example.com）
   redirect=
   redirect_to=
   redirect_url=
   url=
   jump=
   jump_to=
   target=
   to=
   link=
   linkto=
   domain=
   redirect=
   redirect_to=
   redirect_url=
   url=
   jump=
   jump_to=
   target=
   to=
   link=
   linkto=
   domain=
   Out=
   Dout=
   go=
   return=
   returnTo=
   logout=
   register=
   login=
   returnUrl=
   path=
   redirectURI=
   redir=
   returl=
   share=
   wap=
   src=
   source=
   u=
   display=
   sourceURl=
   imageURL=
   linkurl=
   RedirectUrl=
   service=
   redirect_uri=
   destUrl=
   oauth_callback=
   oauth=
   goto=
   redirectUrl=
   callback=
   return_url=
   toUrl=
   ReturnUrl=
   fromUrl=
   redUrl=
   request=
   ```

3. bypass

   ```
   无协议头绕过
   https://debian.local/redirect.php?url=/www.example.com
   https://debian.local/redirect.php?url=\www.example.com
   https://debian.local/redirect.php?url=//www.example.com
   https://debian.local/redirect.php?url=///www.example.com
   https://debian.local/redirect.php?url=www.example.com
   @ 绕过 
   http://debian.local/redirect.php?url=http://debian.local@example.com
   ? 绕过
   http://debian.local/redirect.php?url=http://example.com?debian.local
   . 绕过
   http://debian.local/redirect.php?url=http://debian.local.example.com
   # 绕过
   http://debian.local/redirect.php?url=http://example.com#debian.local
   / 绕过，可以尝试多个正斜杠一起用，如/、//、///
   http://debian.local/redirect.php?url=http://example.com/debian.local
   \ 绕过
   http://debian.local/redirect.php?url=http://example.com\debian.local
   双写参数 绕过
   http://debian.local/redirect.php?url=http://debian.local&url=http://example.com
   进制 绕过
   http://debian.local/redirect.php?url=http://3232235777   
   （3232235777为IP地址192.168.1.1的十进制值
   以192.168.1.1为例，把它转为10进制数的公式是：
   192 * 256^3 + 168 * 256^2 +1 * 256 + 1 * 1 = 3232235777）
   第三方 绕过
   http://debian.local/redirect.php?url=https://www.example.com/link?url=yti8PhYOnbmJkgvkJj4P7iT4HLM4BO9pK0esOAK376K
   （假设网站是允许跳转example.com这个域名的，但不可跳转别的域名，那就可以借助example.com这个域名来实现跳转到其他网站）
   重复特殊字符绕过
   https://debian.local/redirect.php?url=//www.example.com//..
   https://debian.local/redirect.php?url=www.example.com//..
   ```

### 电商漏洞

1. 提前购买

   ```
   某些电商在节日活动时会有商品预售的功能
   假设：预售订单的商品 ID 为 001，普通订单的商品 ID 为 002
   那么当购买普通商品，提交订单时，将商品订单从 002 修改为 001 ，即可购买预售商品
   ```

### 匿名漏洞

1. 抓包匿名评价页面，或查看源代码，若有用户信息则存在漏洞

### fuzz 漏洞

1. 构造注册字段

   ```
   注册普通用户的字段时，数据可能为 user_name=test&user_passwd=123456
   构造字段为 user_name=test&user_passwd=123456&user_level=1 则有可能注册为管理员账号
   类似的还有：
   user_rank=1
   user_level=1
   user_type=1
   ```

### （五）支付漏洞

### 签约漏洞

相当于在多个手机登录同一个账号进入支付界面后并发支付

1. 针对一次性优惠活动的签约（一般会出现在最新的活动页面，如国庆特惠）

   ```
   推荐使用分别两种支付方式，如 A 使用微信支付， B 使用 支付宝支付
   若未生成订单可尝试重放请求包或并发
   
   先使用 A 手机登录账号购买优惠业务，在订单支付界面暂停
   再使用 B 手机登录此账号购买优惠业务（由于 A 手机已经进入到了支付界面，账号下线无所谓），在订单支付界面暂停
   A 手机进行支付，后解除自动付费
   B 手机进行支付，后解除自动付费
   一次性优惠活动使用了两次，可造成签约漏洞
   ```

2. 从普通会员升级到超级会员的功能

   ```
   先使用 A 手机登录账号购买普通会员后，再购买升级为超级会员，此时在订单支付界面暂停
   再使用 B 手机登录账号，购买升级为超级会员，在订单支付界面暂停
   A 手机进行支付后 B 手机进行支付
   会多出两个月的超级会员，且这两个月都是使用的从普通会员升级到超级会员的价格
   ```

3. 使用优惠券的订单

   ```
   使用优惠券购买后停留在支付界面取消订单，会返回优惠券
   可再次使用优惠券购买
   ```

### 低价充值

四舍五入

```
充值 0.016 元到账 0.02 元
如果到账 0.01 元则可能是不显示小数点后第三位，再尝试充值一遍 0.016 元，到账 0.016+0.016≈0.03 则漏洞存在
```

### 越权花别人的钱

### 花更少的钱获取更多的服务

### 交易密码绕过

### 案例

1. 负数购买

   ```
   假设火腿十元一根，目前账户余额 200，买两根
   正常情况：200-2*10=200-20=180
   hacker：200-(-2*10)=200-(-20)=200+20=220
   或者：200-(2*-10)=200-(-20)=200+20=220
   
   有些时候需要使用积分兑换，积分不够可尝试修改返回包进入订单支付或抓包修改积分值
   ```

2. 修改内容

   ```
   云服务器购买逻辑设计不严密，经过base64编码的数据可以被改，实现原有买低配的价格可以直接买高配，例如：将 5 GB 带宽求改为 50 GB（可能会出现在订单生成界面或者支付界面）
   
   查看支付跳转链接如下：
   http://example.com/goPay.html?amount=6789&pId=&oId=&stage=1&pInfo=6789
   其中 amount=6789 为订单金额，pInfo=6789 为付款金额，可尝试一次修改，或同时修改
   http://example.com/goPay.html?amount=0.1&pId=&oId=&stage=1&pInfo=0.1
   ```

3. 修改金额

   ```
   修改为负数
   直接修改金额。如 100 元修改为 1，0.01，99 元
   小数点前移，如：6789 元修改为 67.89 元
   修改为内部套餐，如同一个商品 ID=1 需要 100 元，商品 ID=2 为内部套餐需要 10 元 修改商品 ID=1 为 ID=2 即可使用内部套餐
   ```

4. 无限重放（并发）

   ```
   退款并发，提现并发，使用优惠券并发
   ```

5. 修改运费

   ```
   将运费的价格修改
   ```

6. 正负叠加

   ```
   A 商品 30 元每件
   B 商品 10 元每件
   组合购买购买 1 件 A 商品，-2 件 B 商品
   hacker：30x1+10x-2=20
   ```

7. 优惠券漏洞

   ```
   并发
   修改优惠金额，如 5 元优惠券修改为 50 元
   couponMoney= 5 修改为 couponMoney= 50
   修改有优惠券金融，可能要同时修改订单金额（talMoney）和支付金额（payMoney）
   payMoney = talMoney - couponMoney
   ```

8. int 溢出

   ```
   有符号 int32：-2,147,483,648 到 2,147,483,647
   无符号 int32：0 到 4,294,967,295
   两种 int32 最大值为 4294967296，充值 98998996172801 都会支付溢出，最后支付 1 元
   
   第三方支付如支付宝，微信时使用的是有符号 int32 范围一般是 0-2,147,483,647
   则 217483648 = 0 ，217483649 = 1
   若某个产品单价为 ￥2，那么购买 1073741825 个产品的价格为 1073741825 x 2 = 217483650 = 2
   ```

9. 科学计数法

   ```
   在不允许出现小数或有最大值限制的场景可尝试科学计数法
   1E+13=1×10^13=10,000,000,000,000
   1E-5=1×10^13=00000.1
   ```

10. 充值赠送 ID

   ```0000
   充值 1 元时，将赠送额度 t_coin_gift=0，改为 t_coin_gift=10，则到账 11 元
   ```

11. 成人票改为儿童票

    ```
    type:"child"
    ```

12. 权益升级

    ```
    买一年普通会员，再买一年超级会员，会变成两年超级会员
    ```

13. 修改参数

    ```
    奖金额或数量改为
    -1,0.01,0.019,217483649
    ```

14. 遍历 ID

    ```
    product id 产品 ID ,隐藏商品
    user id 用户 ID
    address id 地址 ID，信息泄露
    ```

### （六）并发漏洞

多线程请求，推荐使用 turbo intruder，并发 30 次即可（并发 30 次即使仅成功 5 次也可），注意挂代理

注意提交报告时不要说使用了 turbo intruder 插件（问就是加钱）

### 案例

1. 刷赞

   ```
   报告
   标题：example 存在并发刷赞漏洞，可随意控制排名
   自评等级：
   详细内容：来到 http://example.com/index.html
   截图点赞捕获请求包的过程（不带 x-req:%s ）
   直接写并发成功，可以成功刷赞
   危害：可控制热度
   修复建议：数据库加锁
   ```

2. 签到

   ```
   可拿积分换物品
   ```

3. 突破限购

   ```
   限购商品可尝试并发
   ```

4. 突破地址上限

   ```
   某些只能设置一个收货地址，使用并发可设置多个
   ```

5. 领券

   ```
   各类优惠券的领取可并发领取
   ```

6. 刷积分

7. 并发提现

8. 并发抽奖

9. 下单时并发使用优惠券

   ```
   创建订单时并发可能由于有订单编号无法并发，如订单 1001 无法并发要修改订单编号
   ```

10. 提现

    ```
    提现时并发数据包（一般会出现在至少可正常并发两次的数据包中，如余额 5 元，那么使用 2 元提现的数据包可实行并发，而使用 3 元提现的数据包则无法并发）
    ```

### （七）高危漏洞

### webshell

1. 目标自己写的功能

2. 借用框架

   ```
   ueditor 编辑器漏洞
   ```

### 严重的逻辑设计缺陷

越权（增删改查）

```
银行卡号和手机号未做绑定，输入他人的银行卡号和自己的手机号，可查询他人的银行流水
```

### 严重的敏感信息泄露

Access 泄露

```
字段为 AccessKeyID 和 AccessKeySecret
得到后可使用 oss 浏览器登录
```

### 拒绝服务的漏洞（谨慎挖掘，推荐只挖掘客户端）

### 存储 XSS

###  RCE

### 任意文件读取

```
http://www.example.com?achtion=cat&file=../../../etc/passwd
```

### csrf

攻击者使用自己的账号构造操作请求包，当受害者访问时会进行相应操作如：修改密码、转账

类似于 ssrf 可在很多位置操作，如：修改资料将头像修改为退出登录（直接提交访问 `https://xxxxxxxxx.com/logout` 会退出登录可能不收，可进行 csrf 的二次利用，）

```
username=ggb&images=https://xxxxxxxxx.com/xxxxxxxxxxxx.png
可构造为用户退出
username=ggb&images=https://xxxxxxxxx.com/logout
此时加载受害者加载攻击者头像时就会退出登录，记得保存正常 的数据包，否则自己的账号会无法登录
```

### ssrf

利用 Web 访问目标内网 

```
http://example.com?url=http://192.168.1.1
http://example.com?url=http://localhost
http://example.com?url=file:///etc/passwd
http://example.com?url=file:///C:/Windows/win.ini
```

ssrf 常见位置

```
分享：通过URL地址分享网页内容
转码服务
在线翻译
图片加载与下载：通过URL地址加载或下载图片
图片、文章收藏功能
未公开的 api 实现以及其他调用 URL 的功能
URL 关键字：share,wap,url,link,src,source,target,u,3g,display,sourceURL,imageURL,domain
```

nday

```
https://blog.csdn.net/haha13l4/article/details/99099441
```

### sql 注入

### 支付漏洞 

越权支付

```
信用卡号和手机号不做绑定
用他人的信用卡支付，用自己的手机号接收验证码
```

遍历订单号

```
订单号字段一般为 orderid ，购买商品 A 时可使用 B 的订单号，价格可能不同
```

### （八）场景

### 抽奖

修改抽奖次数，无限重放、并发抽奖，修改抽奖结果，越权查看手机号、抽奖记录

### 论坛

刷赞，刷评论，越权，xss

### 匿名

匿名信息泄漏

### 付费绕过

数据包 m3u8 链接泄露

```
利用：https://m3u8play.com/
```

### 企业邮箱注册绕过

尝试注册企业邮箱

```
test@edu.com
```

抓包，修改邮箱为普通邮箱

```
123123@qq.com
```

### （九）隐私合规漏洞挖掘

1. 隐私政策是独立于用户协议的账号处理规则，需要公开 APP 所有处理规则和基本情况，包括开办的基本信息，APP 对个人信息收集、使用、共享及披露的基本情况，用户对于处理自己信息的基本权利，包括 ==查看、删除、注销、投诉== 等以及政策发布、生效或更新日期
2. 若只有用户协议而 ==无隐私政策== 则是 ==违规== 的
3. 隐私政策的描述情况需要符合 APP 的实际情况，例如隐私政策中对于 ==注销、投诉提供的操作方法==，需与 APP 内实际操作路径相一致
4. 另外，对于业务开展目标用户为 ==14 周岁以下== 的儿童，需要有专门的儿童个人信息保护规则
5. 必须是 ==最新版 APP== 

**违规案例**

```
无隐私政策
注册时无隐私政策弹窗
无法查看隐私政策
无法拒绝隐私政策
拒绝隐私政策没有访客模式或者二次弹窗提醒
无查看、删除、注销、投诉渠道
注销、投诉提供的操作方法于隐私政策不一致
查看隐私政策所需的点击次数大于四次
隐私政策更新后不弹窗
儿童业务无专门的隐私政策
无逝者的隐私政策
默认勾选同意隐私协议
注册时将台湾列为国家
拒绝获取不必要的权限后无法使用 APP ， 详见：《常见类型移动互联网应用程序必要个人信息范围规定》
```

> 各大 src 平台有相应的隐私合规漏洞判定标准，若提交的平台没有，可参考其它的 src，建议直接高危

注销

```
有注册就必须有注销
注销功能是否有用
注销功能若需要联系客服，是否是在十五个工作日以内完成
注销提供条件不能多余注册时提供条件
注销政策要提到十五个工作日以内完成 
```

权限获取

```
发起权限申请时要说明使用原因
频繁索取权限 
```

报告模板

```
标题：
xxx APP xxx 版本存在默认默认勾选同意隐私协议漏洞

内容：
在小米官方商店，下载 xxx APP 最新版，版本 xxx
打开 APP，输入手机号注册，发现左下角默认同意了隐私政策
漏洞截图、版本截图和官网最新版本截图
此行为违反了 《App违法违规收集使用个人信息行为认定方法》某条某项
法规截图，法规官方链接
上传法律文件

修复建议：
隐私政策应由用户自己勾选，不得默认勾选
```

 
