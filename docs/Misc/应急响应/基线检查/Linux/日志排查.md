## 1 日志路径及其作用

```
日志路径                 作用
/var/log/message        包括整体系统信息
/var/log/auth.log       包含系统授权信息，包括用户登录和使用的权限机制等
/var/log/userlog        记录所有等级用户信息的日志
/var/log/cron           记录 crontab 命令是否被正确的执行
/var/log/vsftpd.log     记录 Linux FTP 日志
/var/log/lastlog        记录登录的用户，可以使用命令 lastlog 查看
/var/log/secure         记录大多数应用输入的账号与密码，登录成功与否
/var/log/wtmp           记录登录系统成功的账户信息，等同于命令 las
/var/log/btmp           记录登录系统失败的用户名单，等同于命令 lastb
/var/log/faillog        记录登录系统不成功的账号信息
```

## 2 SSH 登录日志排查

查看日志

```shell
root@debian:~# vim /var/log/secure
```

查看日志记录行为是否被篡改

```shell
root@debian:~# vim /etc/cron.daily/logrotate
```

查看日志并提取登录成功记录

```shell
root@debian:~# cat /var/log/secure | grep Accepted /var/log/secure*
```

查看日志并提取登录失败记录

```shell
root@debian:~# cat /var/log/secure | grep Failed /var/log/secure*
```

提取与登录失败或身份验证失败相关的记录

```shell
root@debian:~# cat /var/log/secure | grep Failed /var/log/secure* |grep "invalid\|release"|awk '{print $9 "\t" $11}'
```

## 3 计划任务排查

查看日志

```shell
root@debian:~# vim /var/log/cron
```

提取所有的计划任务

```shell
root@debian:~# cat /etc/passwd | cut -f 1 -d : |xargs -i crontab -l -u {}
```

提取所有执行的计划任务

```shell
root@debian:~# cat /var/log/cron* |awk -F':' '{print $NF}' |grep CMD |sort|uniq -c|sort -rn
```

列出所有创建计划任务的用户

```shell
root@debian:~# ls /var/spool/cron/
```

查看 root 用户的计划任务

```shell
root@debian:~# cat /var/spool/cron/root
```

查看当前用户的计划任务

```shell
root@debian:~# crontab -l
```

查看指定用户的计划任务

```shell
root@debian:~# crontab -l -u [user_name]
```

查找系统级别的计划任务文件

```shell
root@debian:~# find /etc/cron* -type f
```

## 4 历史命令排查

查看历史命令

```shell
root@debian:~# history
```

查看历史命令文件

```shell
root@debian:~# vim ~/.bash_history
```

列出所有历史命令相关的文件

```shell
root@debian:~# find / -name .bash_history
```

将本次登录时执行的命令写入到历史命令文件

```shell
root@debian:~# history -w
```

清空本次登录时执行的命令

```shell
root@debian:~# history -c
```

清空所有历史命令

```shell
root@debian:~# echo > ~/.bash_history
```

擦除所有历史命令

```shell
root@debian:~# shred -u -z -v ~/.bash_history
```

## 5 系统日志排查

查看登录成功日志

```shell
root@debian:~# /var/log/wtmp
```

查看登录失败日志

```shell
root@debian:~# /var/log/btmp
```

展示当前登录用户信息

```shell
root@debian:~# w
```

显示最近一次登录信息

```shell
root@debian:~# lastlog
```

## 6 系统用户排查

查看用户

```shell
root@debian:~# vim /etc/passwd
```

查看密码

```shell
root@debian:~# vim /etc/shadow
```

查看组

```shell
root@debian:~# vim /etc/group
```

创建用户

```shell
root@debian:~# useradd [user_name]
```

查看 root 用户的权限 

```shell
root@debian:~# vim /etc/passwd
```

```shell
root:x:0:0:root:/root:/bin/bash
```

排查所有 root 权限的用户

```shell
root@debian:~# awk -F':' '$3==0{print $1}'  /etc/passwd
```

设置允许 SSH 空口令登录 

```shell
root@debian:~# vim /etc/ssh/sshd_config
```

```
58 PermitEmptyPasswords yes
```

空口令用户

```shell
root@debian:~# vim /etc/shadow
```

```
[user_name]::19570:0:99999:7:::
```

